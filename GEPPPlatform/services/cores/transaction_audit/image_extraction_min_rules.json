{
  "metadata": {
    "version": "2.0.0",
    "description": "Per-image extraction rules - returns array with file_id, materials dict, and overview",
    "purpose": "Extract observations for each image individually with structured format for materials",
    "mode": "per_image",
    "output_format": "JSON array with {file_id, materials, overview} per image",
    "created_date": "2025-11-06",
    "last_modified": "2025-11-10"
  },
  "extraction_instructions": {
    "system_instruction": "Extract key waste observations. Focus on: 1) What items you see 2) Any contamination 3) Visibility. Be concise but thorough with small objects.",
    "guidelines": [
      "List all items including small objects (straws, batteries, caps)",
      "Note contamination/mixing",
      "Assess visibility %",
      "Flag hazardous items immediately"
    ]
  },
  "critical_checks": {
    "priority_1_hazardous": {
      "check": "Are batteries, bulbs, sprays, or electronics visible?",
      "action": "If YES: Flag immediately as red flag. List specific items.",
      "importance": "CRITICAL - Single battery in wrong category = violation"
    },
    "priority_2_contamination": {
      "check": "Is waste pure or mixed? Any small contaminants (straws, containers)?",
      "action": "Note all mixing and contamination",
      "importance": "CRITICAL - Straws/containers in food waste = violation"
    },
    "priority_3_visibility": {
      "check": "Can you identify waste type? (0-100%)",
      "action": "Give visibility % and assessment",
      "importance": "LOW - Only flag if completely opaque (0%)"
    },
    "priority_4_small_objects": {
      "check": "Check corners, edges, between items for small objects",
      "focus": "Batteries, bulbs, straws, utensils, caps, small containers",
      "action": "List all small objects found",
      "importance": "CRITICAL - Small objects often cause violations"
    }
  },
  "extraction_prompt_template_minimal": "วิเคราะห์ภาพขยะแต่ละภาพและส่งกลับเป็น JSON ARRAY เท่านั้น\n\n# โครงสร้าง Output (ต้องเป็น ARRAY):\n[\n  {\"file_id\": <ตัวเลข>, \"materials\": {\"<ชื่อวัสดุ>\": \"<สภาพ>\"}, \"overview\": \"<ข้อความสั้นๆ>\"}\n]\n\n# กฎสำคัญ:\n1. ส่งกลับเฉพาะ JSON ARRAY - ห้ามส่งข้อความอื่น\n2. 1 ภาพ = 1 object ใน array\n3. มี 3 fields เท่านั้น: file_id, materials, overview\n4. materials: สูงสุด 5-8 รายการ (รายการหลัก + ของปนเล็กๆ)\n5. overview: สูงสุด 1-2 ประโยค\n6. ห้ามส่งค่าอื่น: ห้าม record_id, items, red_flags, hazardous, etc.\n\n# ต้องตรวจ:\n- แบตเตอรี่/หลอดไฟ (ของเล็กในมุม, ซอกต่างๆ) → ต้องระบุ\n- หลอด/ช้อน/กล่อง/ฝาพลาสติก ปนในเศษอาหาร → ต้องระบุ\n- ของปนเปื้อน/ของปนกัน → ระบุชัดเจน\n\n# ตัวอย่าง:\n[\n  {\"file_id\": 123, \"materials\": {\"เศษอาหาร\": \"เปลือกผักผลไม้\", \"หลอดพลาสติก\": \"หลอดแดงปนอยู่\", \"กล่องโฟม\": \"กล่องขาวเปื้อนอาหาร\"}, \"overview\": \"ถุงใสมีเศษอาหารปนหลอดและกล่อง ถุงเปิดมองเห็นได้ชัด\"},\n  {\"file_id\": 124, \"materials\": {\"กล่องกระดาษ\": \"แบนเรียบร้อย\", \"กระดาษ\": \"กระดาษสะอาด\"}, \"overview\": \"กล่องกระดาษใส่กระดาษรีไซเคิล ไม่มีของปน\"}\n]\n\n# ข้อห้าม:\n❌ ห้ามคิดมาก - ส่งแค่ JSON ARRAY\n❌ ห้ามอธิบายเพิ่ม - ส่งแค่ที่กำหนด\n❌ ห้าม field อื่น - มี 3 fields เท่านั้น\n❌ ห้ามนับรายการเกิน 8 ต่อภาพ - เลือกของสำคัญ\n\nเริ่มวิเคราะห์และส่ง JSON ARRAY:",
  "output_format": {
    "structure": "JSON array with one object per image containing: file_id (number), materials (dict), overview (string)",
    "critical_rules": [
      "MUST return a JSON array, not an object",
      "Each array element = one image observation",
      "ONLY three fields allowed: file_id, materials, overview",
      "file_id must be a number matching the image file ID",
      "materials must be a dict/object with material names as keys and condition descriptions as values",
      "overview must be a string describing the overall image"
    ],
    "max_length": "Keep material descriptions and overview concise but thorough"
  },
  "small_object_focus": {
    "critical_items": [
      "Batteries (any size) - CRITICAL",
      "Light bulbs/CFLs - CRITICAL",
      "Spray cans/aerosols - CRITICAL",
      "Plastic straws/utensils - CRITICAL for food waste",
      "Bottle caps/lids",
      "Small containers/packaging",
      "Electronics parts",
      "Wires/cables"
    ],
    "detection_note": "Check corners, edges, between items. One small battery = violation."
  },
  "contamination_patterns": {
    "food_waste_violations": [
      "Straws/utensils present",
      "Food in containers (not just outer bag)",
      "Inner packaging/bags",
      "Non-compostable items"
    ],
    "hazardous_anywhere": [
      "Batteries in non-hazardous = RED FLAG",
      "Bulbs in non-hazardous = RED FLAG",
      "Sprays in non-hazardous = RED FLAG"
    ]
  },
  "response_examples": {
    "clean_food_waste_example": [
      {
        "file_id": 101,
        "materials": {
          "vegetable scraps": "fresh peels and trimmings",
          "fruit peels": "banana and orange peels",
          "cooked rice": "small amount of leftover rice"
        },
        "overview": "Clear plastic bag, open, containing pure organic food waste. No contamination visible. All items are compostable."
      }
    ],
    "contaminated_food_waste_example": [
      {
        "file_id": 201,
        "materials": {
          "food scraps": "mixed vegetable and fruit waste",
          "plastic straw": "red plastic straw mixed in the waste",
          "foam container": "white foam container with food residue attached"
        },
        "overview": "White plastic bag, closed, containing food waste contaminated with plastic straw and foam container. Contamination clearly visible."
      }
    ],
    "hazardous_contamination_example": [
      {
        "file_id": 301,
        "materials": {
          "cardboard boxes": "clean flattened boxes",
          "paper": "mixed office paper",
          "AA battery": "small battery visible in corner between cardboard pieces"
        },
        "overview": "Cardboard box containing recyclable paper and cardboard BUT contaminated with small AA battery in bottom corner. Battery clearly visible."
      }
    ],
    "multiple_images_example": [
      {
        "file_id": 401,
        "materials": {
          "plastic bottles": "clear PET bottles, crushed",
          "aluminum cans": "various beverage cans, some crushed"
        },
        "overview": "Clear bag containing clean recyclables. Bottles and cans properly separated and prepared."
      },
      {
        "file_id": 402,
        "materials": {
          "glass bottles": "brown and clear glass bottles",
          "plastic cap": "one bottle still has plastic cap attached"
        },
        "overview": "Box containing glass bottles. One bottle has plastic cap that should be removed."
      }
    ]
  }
}
